<div class="player-management-container">
  <div class="player-management-header">
    <h2>Player Management</h2>
    <button 
      (click)="toggleCreateForm()" 
      class="btn btn-primary">
      {{ showCreateForm() ? 'Cancel' : '+ Add Player' }}
    </button>
  </div>

  @if (showCreateForm()) {
    <div class="create-player-form">
      <h3>Create New Player</h3>
      <form (ngSubmit)="createPlayer()" #playerForm="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="playerName">Player Name *</label>
            <input
              type="text"
              id="playerName"
              [(ngModel)]="playerName"
              name="playerName"
              class="form-control"
              placeholder="Enter player name"
              required>
          </div>
          
          <div class="form-group">
            <label for="characterName">Character Name *</label>
            <input
              type="text"
              id="characterName"
              [(ngModel)]="characterName"
              name="characterName"
              class="form-control"
              placeholder="Enter character name"
              required>
          </div>
        </div>

        <div class="form-group">
          <label for="characterClass">Character Class *</label>
          <select
            id="characterClass"
            [(ngModel)]="selectedClass"
            name="characterClass"
            class="form-control"
            required>
            @for (classOption of characterClasses; track classOption) {
              <option [value]="classOption">
                {{ classOption.charAt(0).toUpperCase() + classOption.slice(1) }}
              </option>
            }
          </select>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!playerForm.valid">
            Create Player
          </button>
          <button 
            type="button" 
            (click)="toggleCreateForm()" 
            class="btn btn-secondary">
            Cancel
          </button>
        </div>
      </form>
    </div>
  }

  <div class="players-section">
    @if (currentPlayers().length === 0) {
      <div class="no-players-message">
        <h3>No Players in Session</h3>
        <p>Add players to start managing them.</p>
      </div>
    } @else {
      <div class="players-grid">
        @for (player of currentPlayers(); track player.id) {
          <div 
            class="player-card"
            [class.selected]="selectedPlayerId() === player.id"
            (click)="selectPlayer(player.id)">
            
            <div class="player-header">
              <div class="player-avatar">
                {{ player.character.class.charAt(0).toUpperCase() }}
              </div>
              <div class="player-names">
                <h4>{{ player.name }}</h4>
                <p>{{ player.character.name }}</p>
                <span class="character-class">
                  Level {{ player.character.level }} {{ player.character.class }}
                </span>
              </div>
              <button 
                (click)="removePlayer(player.id); $event.stopPropagation()"
                class="btn btn-danger btn-sm remove-btn"
                title="Remove Player">
                ‚úï
              </button>
            </div>

            <div class="player-stats">
              <div class="stat-row">
                <label>Health</label>
                <div class="stat-bar-container">
                  <div class="stat-bar">
                    <div 
                      class="stat-fill health"
                      [style.width.%]="getHealthPercentage(player)"
                      [style.background-color]="getHealthBarColor(getHealthPercentage(player))">
                    </div>
                  </div>
                  <span class="stat-text">
                    {{ player.stats.health }}/{{ player.stats.maxHealth }}
                  </span>
                </div>
                <div class="stat-controls">
                  <button 
                    (click)="damagePlayer(player.id, 10); $event.stopPropagation()"
                    class="btn btn-sm btn-danger"
                    title="Damage -10">
                    -10
                  </button>
                  <button 
                    (click)="healPlayer(player.id, 10); $event.stopPropagation()"
                    class="btn btn-sm btn-success"
                    title="Heal +10">
                    +10
                  </button>
                </div>
              </div>

              <div class="stat-row">
                <label>Mana</label>
                <div class="stat-bar-container">
                  <div class="stat-bar">
                    <div 
                      class="stat-fill mana"
                      [style.width.%]="getManaPercentage(player)">
                    </div>
                  </div>
                  <span class="stat-text">
                    {{ player.stats.mana }}/{{ player.stats.maxMana }}
                  </span>
                </div>
              </div>

              <div class="stat-row">
                <label>Experience</label>
                <span class="stat-value">{{ player.stats.experience }} XP</span>
              </div>

              <div class="stat-row">
                <label>Gold</label>
                <span class="stat-value">{{ player.stats.gold }} ü™ô</span>
              </div>

              <div class="stat-row">
                <label>Position</label>
                <span class="stat-value">
                  ({{ player.position.x }}, {{ player.position.y }}) 
                  facing {{ player.position.facing }}
                </span>
              </div>
            </div>

            <div class="player-actions">
              <button 
                (click)="restorePlayer(player.id); $event.stopPropagation()"
                class="btn btn-sm btn-success"
                title="Full Restore">
                üîÑ Restore
              </button>
              <button 
                (click)="levelUpPlayer(player.id); $event.stopPropagation()"
                class="btn btn-sm btn-primary"
                title="Level Up">
                ‚¨ÜÔ∏è Level Up
              </button>
            </div>

            <div class="player-abilities">
              <h5>Abilities</h5>
              <div class="abilities-list">
                @for (ability of player.character.abilities; track ability.id) {
                  <div class="ability-item" [title]="ability.description">
                    <span class="ability-name">{{ ability.name }}</span>
                    <span class="ability-cost">{{ ability.manaCost }} MP</span>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  @if (selectedPlayer(); as player) {
    <div class="player-details">
      <h3>{{ player.name }} Details</h3>
      
      <div class="detail-sections">
        <div class="character-info">
          <h4>Character Information</h4>
          <div class="info-grid">
            <div class="info-item">
              <label>Character Name:</label>
              <span>{{ player.character.name }}</span>
            </div>
            <div class="info-item">
              <label>Class:</label>
              <span>{{ player.character.class }}</span>
            </div>
            <div class="info-item">
              <label>Level:</label>
              <span>{{ player.character.level }}</span>
            </div>
            <div class="info-item">
              <label>Active:</label>
              <span>{{ player.isActive ? 'Yes' : 'No' }}</span>
            </div>
          </div>
        </div>

        <div class="inventory-section">
          <h4>Inventory</h4>
          @if (player.inventory.length === 0) {
            <p class="empty-inventory">No items in inventory</p>
          } @else {
            <div class="inventory-grid">
              @for (item of player.inventory; track item.id) {
                <div class="inventory-item">
                  <div class="item-icon">{{ item.name.charAt(0) }}</div>
                  <div class="item-info">
                    <span class="item-name">{{ item.name }}</span>
                    <span class="item-quantity">x{{ item.quantity }}</span>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
